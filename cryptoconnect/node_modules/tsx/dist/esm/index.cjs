"use strict";var q=Object.defineProperty;var d=(e,t)=>q(e,"name",{value:t,configurable:!0});var b=require("node:worker_threads"),u=require("../node-features-C11kbLv2.cjs"),T=require("../register-V-RpG1jj.cjs");require("../get-pipe-path-BoR10qr8.cjs"),require("node:module");var p=require("node:path"),R=require("node:url");require("get-tsconfig");var o=require("../register-CoxCwfHn.cjs"),v=require("node:fs");require("esbuild"),require("node:crypto");var l=require("../index-gckBtVBf.cjs"),E=require("../client-D6NvIMSC.cjs");require("../require-BpmhaC_r.cjs");var g=require("node:fs/promises");require("module"),require("../temporary-directory-B83uKxJF.cjs"),require("node:os"),require("node:util"),require("../index-BWFBUo6r.cjs"),require("node:net");const f={active:!0},_=d(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);f.namespace=e.namespace,e.tsconfig!==!1&&o.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(f.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(f.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),O=d(()=>(o.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),w=new Map,N=d(async e=>{if(w.has(e))return w.get(e);if(!await v.promises.access(e).then(()=>!0,()=>!1)){w.set(e,void 0);return}const n=await v.promises.readFile(e,"utf8");try{const r=JSON.parse(n);return w.set(e,r),r}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),J=d(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const n=R.fileURLToPath(t),r=await N(n);if(r)return r;const s=t;if(t=new URL("../package.json",t),t.pathname===s.pathname)break}},"findPackageJson"),C=d(async e=>(await J(e))?.type??"commonjs","getPackageType"),W=d(e=>{[e]=e.split("?");const t=p.extname(e);if(t===".mts")return"module";if(t===".cts")return"commonjs"},"getFormatFromExtension"),A=d(e=>{const t=W(e);if(t)return t;const{pathname:n}=new URL(e),r=p.extname(n);if(r===".js"||o.tsExtensions.includes(r))return C(e)},"getFormatFromFileUrl"),y="tsx-namespace=",P=d(e=>{const t=e.indexOf(y);if(t===-1)return;const n=e[t-1];if(n!=="?"&&n!=="&")return;const r=t+y.length,s=e.indexOf("&",r);return s===-1?e.slice(r):e.slice(r,s)},"getNamespace"),S=d(e=>{if(!e.includes("%3F"))return e;const[t,n]=e.split("%3F",2),r=decodeURIComponent(n);return`${t}?${r}`},"decodeCjsQuery"),j=u.isFeatureSupported(u.importAttributes)?"importAttributes":"importAssertions";if(exports.load=async(e,t,n)=>{if(!f.active)return n(e,t);e=S(e);const r=P(e);if(f.namespace&&f.namespace!==r)return n(e,t);if(f.port){const a=new URL(e);a.searchParams.delete("tsx-namespace"),f.port.postMessage({type:"load",url:a.toString()})}E.parent.send&&E.parent.send({type:"dependency",path:e});const s=e.startsWith(o.fileUrlPrefix)?R.fileURLToPath(e):e;if(t.format==="module-json"){const a=await g.readFile(new URL(e),"utf8"),m=await l.transform(a,s,{tsconfigRaw:p.isAbsolute(s)?o.fileMatcher?.(s):void 0});return{shortCircuit:!0,format:"module",source:o.inlineSourceMap(m)}}if(t.format==="commonjs-json"){const a=await g.readFile(new URL(e),"utf8"),m=l.transformSync(a,s,{tsconfigRaw:p.isAbsolute(s)?o.fileMatcher?.(s):void 0});return m.code+=`
0 && (module.exports = ${JSON.stringify(Object.fromEntries(Object.keys(JSON.parse(a)).map(h=>[h,0])))});`,{shortCircuit:!0,format:"commonjs",source:o.inlineSourceMap(m)}}if((t.format===void 0||t.format==="commonjs"||t.format==="commonjs-typescript")&&u.isFeatureSupported(u.esmLoadReadFile)&&e.startsWith("file:")&&s.endsWith(".js")){const a=await g.readFile(new URL(e),"utf8");if(l.isESM(a)){const m=l.transformSync(a,e,{tsconfigRaw:o.fileMatcher?.(s)});if(u.isFeatureSupported(u.loadReadFromSource))return{shortCircuit:!0,format:"commonjs",source:o.inlineSourceMap(m)};const h=r?`${s}?namespace=${encodeURIComponent(r)}`:s;return{shortCircuit:!0,format:"commonjs",responseURL:`data:text/javascript,${encodeURIComponent(m.code)}?filePath=${encodeURIComponent(h)}`}}}if(o.isJsonPattern.test(e)){let a=t[j];a||(a={},t[j]=a),a.type||(a.type="json")}const c=await n(e,t);if(o.logEsm(3,"loaded by next loader",{url:e,loaded:c}),c.format==="commonjs"){if(u.isFeatureSupported(u.loadReadFromSource)&&s.endsWith(".cjs")){let a=await g.readFile(new URL(e),"utf8");const m=l.transformDynamicImport(s,a);return m&&(a=o.inlineSourceMap(m)),c.source=a,c.shortCircuit=!0,c}if(u.isFeatureSupported(u.esmLoadReadFile)&&c.responseURL?.startsWith("file:")&&!s.endsWith(".cjs")){const a=await g.readFile(new URL(e),"utf8");if(!s.endsWith(".js")||l.isESM(a)){const m=l.transformSync(a,e,{tsconfigRaw:o.fileMatcher?.(s)});if(u.isFeatureSupported(u.loadReadFromSource))c.source=o.inlineSourceMap(m);else{const h=r?`${s}?namespace=${encodeURIComponent(r)}`:s;c.responseURL=`data:text/javascript,${encodeURIComponent(m.code)}?filePath=${encodeURIComponent(h)}`}return c}if(!c.source)return c.source=a,c}}if(!c.source)return c;const i=c.source.toString();if(u.isFeatureSupported(u.requireEsm)&&c.format==="json"){const a=l.transformSync(i,s,{tsconfigRaw:p.isAbsolute(s)?o.fileMatcher?.(s):void 0});return a.code+=`
0 && (module.exports = ${JSON.stringify(Object.fromEntries(Object.keys(JSON.parse(i)).map(m=>[m,0])))});`,{format:"commonjs",source:o.inlineSourceMap(a)}}if(c.format==="json"||o.tsExtensionsPattern.test(e)){const a=await l.transform(i,s,{tsconfigRaw:p.isAbsolute(s)?o.fileMatcher?.(s):void 0});return{format:"module",source:o.inlineSourceMap(a)}}if(c.format==="module"){const a=l.transformDynamicImport(s,i);a&&(c.source=o.inlineSourceMap(a))}return c},o.debugEnabled){const e=exports.load;exports.load=async(t,n,r)=>{o.logEsm(2,"load",{url:t,context:n});const s=await e(t,n,r);return o.logEsm(1,"loaded",{url:t,result:s}),s}}const L=d(e=>{if(e.url)return e.url;const t=e.message.match(/^Cannot find module '([^']+)'/);if(t){const[,r]=t;return r}const n=e.message.match(/^Cannot find package '([^']+)'/);if(n){const[,r]=n;if(!p.isAbsolute(r))return;const s=R.pathToFileURL(r);if(s.pathname.endsWith("/")&&(s.pathname+="package.json"),s.pathname.endsWith("/package.json")){const c=l.readJsonFile(s);if(c?.main)return new URL(c.main,s).toString()}else return s.toString()}},"getMissingPathFromNotFound"),U=d(async(e,t,n,r)=>{const s=o.mapTsExtensions(e);if(o.logEsm(3,"resolveExtensions",{url:e,context:t,throwError:r,tryPaths:s}),!s)return;let c;for(const i of s)try{return await n(i,t)}catch(a){const{code:m}=a;if(m!=="ERR_MODULE_NOT_FOUND"&&m!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw a;c=a}if(r)throw c},"resolveExtensions"),I=d(async(e,t,n)=>{if(o.logEsm(3,"resolveBase",{specifier:e,context:t,specifierStartsWithFileUrl:e.startsWith(o.fileUrlPrefix),isRelativePath:o.isRelativePath(e),specifierNodeModules:e.includes(o.nodeModulesPath),tsExtensionsPattern:o.tsExtensionsPattern.test(t.parentURL),allowJs:o.allowJs}),(e.startsWith(o.fileUrlPrefix)||o.isRelativePath(e))&&!e.includes("/node_modules/")&&(o.tsExtensionsPattern.test(t.parentURL)||o.allowJs)){const r=await U(e,t,n);if(o.logEsm(3,"resolveBase resolved",{specifier:e,context:t,resolved:r}),r)return r}try{return await n(e,t)}catch(r){if(o.logEsm(3,"resolveBase error",{specifier:e,context:t,error:r}),r instanceof Error){const s=r;if(s.code==="ERR_MODULE_NOT_FOUND"){const c=L(s);if(c){const i=await U(c,t,n);if(i)return i}}}throw r}},"resolveBase"),M=d(async(e,t,n)=>{if(o.logEsm(3,"resolveDirectory",{specifier:e,context:t,isDirectory:o.isDirectoryPattern.test(e)}),(e==="."||e===".."||e.endsWith("/.."))&&(e+="/"),o.isDirectoryPattern.test(e)){const r=new URL(e,t.parentURL);return r.pathname=p.join(r.pathname,"index"),await U(r.toString(),t,n,!0)}try{return await I(e,t,n)}catch(r){if(r instanceof Error){o.logEsm(3,"resolveDirectory error",{specifier:e,context:t,error:r});const s=r;if(s.code==="ERR_UNSUPPORTED_DIR_IMPORT"){const c=L(s);if(c)try{return await U(`${c}/index`,t,n,!0)}catch(i){const a=i,{message:m}=a;throw a.message=a.message.replace(`${"/index".replace("/",p.sep)}'`,"'"),a.stack=a.stack.replace(m,a.message),a}}}throw r}},"resolveDirectory"),$=d(async(e,t,n)=>{if(o.logEsm(3,"resolveTsPaths",{specifier:e,context:t,requestAcceptsQuery:o.requestAcceptsQuery(e),tsconfigPathsMatcher:o.tsconfigPathsMatcher,fromNodeModules:t.parentURL?.includes("/node_modules/")}),!o.requestAcceptsQuery(e)&&o.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const r=o.tsconfigPathsMatcher(e);o.logEsm(3,"resolveTsPaths",{possiblePaths:r});for(const s of r)try{return await M(R.pathToFileURL(s).toString(),t,n)}catch{}}return M(e,t,n)},"resolveTsPaths"),k="tsx://",F=new Map;if(exports.resolve=async(e,t,n)=>{if(!f.active||e.startsWith("node:"))return n(e,t);u.isFeatureSupported(u.loadReadFromSource)&&(e.includes("%3F")&&(e=S(e)),t.parentURL?.includes("%3F")&&(t.parentURL=S(t.parentURL)));let r=P(e)??(t.parentURL&&P(t.parentURL));if(f.namespace){let a;if(e.startsWith(k)){try{a=JSON.parse(e.slice(k.length))}catch{}a?.namespace&&(r=a.namespace)}if(f.namespace!==r)return n(e,t);a&&(e=a.specifier,t.parentURL=a.parentURL)}const[s,c]=e.split("?"),i=await $(s,t,n);if(o.logEsm(2,"nextResolve",{resolved:i}),i.format==="builtin")return i;if(!i.format&&i.url.startsWith(o.fileUrlPrefix)&&(i.format=await A(i.url),o.logEsm(2,"getFormatFromFileUrl",{resolved:i,format:i.format})),c&&(i.url+=`?${c}`),r&&!i.url.includes(y)&&(i.url+=(i.url.includes("?")?"&":"?")+y+r),i.format==="commonjs-typescript"&&(i.format="commonjs"),i.format==="module-typescript"&&(i.format="module"),i.format==="module"&&t.parentURL&&F.get(t.parentURL)==="commonjs"&&(i.format="commonjs"),i.format==="json"&&t.parentURL){const a=F.get(t.parentURL);a==="commonjs"&&(i.format="commonjs-json"),a==="module"&&(i.format="module-json")}if(F.set(i.url,i.format),u.isFeatureSupported([[20,11,0],[22,10,0]])&&i.format==="commonjs"&&i.url.includes("?")){const[a,m]=i.url.split("?");i.url=a+encodeURIComponent(`?${m}`)}return i},o.debugEnabled){const e=exports.resolve;exports.resolve=async(t,n,r)=>{o.logEsm(2,"resolve",{specifier:t,context:n});const s=await e(t,n,r);return o.logEsm(1,"resolved",{specifier:t,context:n,result:s}),s}}u.isFeatureSupported(u.moduleRegister)&&b.isMainThread&&T.register(),exports.globalPreload=O,exports.initialize=_;
