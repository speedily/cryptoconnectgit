"use strict";var e=require("zod"),r=require("@privy-io/api-base"),t=require("./wallet-api/wallets.js");require("./api.js"),require("./core.js"),require("bs58"),require("libphonenumber-js/max"),require("viem"),require("./transaction.js"),require("./wallet-api/export.js");const i=e.z.enum(["ALLOW","DENY"]);let n=e.z.union([e.z.string(),e.z.number(),e.z.boolean(),e.z.null()]),o=e.z.lazy((()=>e.z.union([n,e.z.array(o),e.z.record(o)])));const a=e.z.union([e.z.literal("eq"),e.z.literal("gt"),e.z.literal("gte"),e.z.literal("lt"),e.z.literal("lte"),e.z.literal("in")]),s=e.z.object({operator:a,value:e.z.union([e.z.string(),e.z.array(e.z.string())])}),l=e.z.object({field_source:e.z.literal("ethereum_transaction"),field:e.z.union([e.z.literal("to"),e.z.literal("value")])}).strict().merge(s),c=e.z.object({field_source:e.z.literal("ethereum_calldata"),field:e.z.string(),abi:o}).strict().merge(s),d=e.z.object({field_source:e.z.literal("ethereum_typed_data_domain"),field:e.z.union([e.z.literal("chainId"),e.z.literal("verifyingContract"),e.z.literal("chain_id"),e.z.literal("verifying_contract")])}).strict().merge(s),u=e.z.object({field_source:e.z.literal("ethereum_typed_data_message"),field:e.z.string(),typed_data:e.z.object({types:t.TypedDataTypesInputParams,primary_type:e.z.string()})}).strict().merge(s),m=e.z.object({field_source:e.z.literal("solana_program_instruction"),field:e.z.literal("programId")}).strict().merge(s),z=e.z.object({field_source:e.z.literal("solana_system_program_instruction"),field:e.z.union([e.z.literal("instructionName"),e.z.literal("Transfer.from"),e.z.literal("Transfer.to"),e.z.literal("Transfer.lamports")])}).strict().merge(s),p=e.z.object({field_source:e.z.literal("solana_token_program_instruction"),field:e.z.union([e.z.literal("instructionName"),e.z.literal("TransferChecked.source"),e.z.literal("TransferChecked.destination"),e.z.literal("TransferChecked.authority"),e.z.literal("TransferChecked.amount"),e.z.literal("TransferChecked.mint")])}).strict().merge(s),_=e.z.discriminatedUnion("field_source",[l,c,d,u,m,z,p]),y=e.z.object({name:e.z.string().max(50,"Rule name must be fewer than 50 characters"),conditions:e.z.array(_),action:i}).strict();let h=e.z.union([e.z.literal("eth_sendTransaction"),e.z.literal("eth_signTransaction"),e.z.literal("eth_signTypedData_v4"),e.z.literal("signTransaction"),e.z.literal("signAndSendTransaction"),e.z.literal("exportPrivateKey"),e.z.literal("*")]),g=e.z.object({method:h,rules:e.z.array(y)}).strict().transform((e=>{let r=[];for(let t of e.rules){let i=f.parse({name:t.name,method:e.method,conditions:t.conditions,action:t.action});r.push(i)}return r}));const f=e.z.object({name:e.z.string().max(50,"Rule name must be fewer than 50 characters"),method:h,conditions:e.z.array(_),action:i}).strict(),b=f.extend({id:e.z.string()}).strict(),w=f.extend({id:e.z.string().optional()}).strict();const v=e.z.object({policy_id:e.z.string().min(1),rule_id:e.z.string().min(1)}).catch((({error:e})=>{throw new r.InvalidInputError(e.message,r.PrivyErrorCode.INVALID_DATA)}));let x=e.z.object({version:e.z.literal("1.0"),name:e.z.string().max(50,"Policy name must be fewer than 50 characters"),chain_type:t.ChainType,method_rules:e.z.array(g),default_action:i,...t.OwnerInputFields}).strict(),I=e.z.object({version:e.z.literal("1.0"),name:e.z.string().max(50,"Policy name must be fewer than 50 characters"),chain_type:t.ChainType,rules:e.z.array(w),...t.OwnerInputFields}).strict();const j=e.z.union([x,I]).transform((e=>{if(!("method_rules"in e))return e;{let r={version:e.version,name:e.name,chain_type:e.chain_type,rules:e.method_rules.flat(),owner:e.owner,owner_id:e.owner_id};return"ALLOW"===e.default_action&&r.rules.push(w.parse({name:"Default Action",method:"*",conditions:[],action:i.enum.ALLOW})),I.parse(r)}})).refine((e=>!e.owner||!e.owner_id),{message:"Only one of owner or owner_id can be provided."}),T=I.omit({owner:!0,owner_id:!0}).extend({id:e.z.string(),created_at:e.z.number(),owner_id:t.KeyQuorumId.nullable(),rules:e.z.array(b)}),P=e.z.object({policy_id:e.z.string({required_error:"Policy ID must be provided",invalid_type_error:"Policy ID is not a valid string"}).min(1)}).catch((({error:e})=>{throw new r.InvalidInputError(e.message,r.PrivyErrorCode.INVALID_DATA)}));let C=e.z.object({name:e.z.string().trim().min(1,"Name is required").max(50,"Policy name must be fewer than 50 characters").optional(),method_rules:e.z.array(g).optional(),...t.OwnerInputFields}).strict().superRefine(((e,r)=>{Object.values(e).every((e=>void 0===e||""===e))&&r.addIssue({code:"custom",message:"At least one field must be provided"}),void 0!==e.owner&&void 0!==e.owner_id&&r.addIssue({code:"custom",message:"Only one of owner or owner_id can be provided."})})),A=e.z.object({name:e.z.string().trim().min(1,"Name is required").max(50,"Policy name must be fewer than 50 characters").optional(),rules:e.z.array(f).optional(),...t.OwnerInputFields}).strict().superRefine(((e,r)=>{Object.values(e).every((e=>void 0===e||""===e))&&r.addIssue({code:"custom",message:"At least one field must be provided"}),void 0!==e.owner&&void 0!==e.owner_id&&r.addIssue({code:"custom",message:"Only one of owner or owner_id can be provided."})}));const q=e.z.union([C,A]).transform((e=>"method_rules"in e?A.parse({name:e.name,rules:e.method_rules?.flat()??[],owner:e.owner,owner_id:e.owner_id}):A.parse(e)));exports.BaseCondition=s,exports.Condition=_,exports.ConditionOperator=a,exports.EthereumCalldataCondition=c,exports.EthereumTransactionCondition=l,exports.EthereumTypedDataDomainCondition=d,exports.EthereumTypedDataMessageCondition=u,exports.LegacyRule=y,exports.PolicyAction=i,exports.PolicyIdFromPath=P,exports.PolicyResponse=T,exports.PolicyWithoutValidation=j,exports.Rule=w,exports.RuleIdAndPolicyIdFromPath=v,exports.RuleInput=f,exports.RuleResponse=b,exports.SolanaProgramInstruction=m,exports.SolanaSystemProgramInstruction=z,exports.SolanaTokenProgramInstruction=p,exports.UpdatePolicyInput=q,exports.generateRuleIdFromName=function(e){return e.toLowerCase().replace(/ /g,"-")+"-"+crypto.randomUUID().slice(0,8)};
